(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{62665:function(e,t,s){Promise.resolve().then(s.bind(s,45869))},45869:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(3827),n=s(64090),r=s(38371),i=s(8792),l=s(26587),o=s(24897),d=s(98308),c=s(74994),m=s(10166),x=s(81433),h=s(38333),u=s(23356),p=s(22983),v=s(78720),g=s(66363),y=s(98061),b=s(94866);let j={positive:"#4CAF50",neutral:"#FFC107",negative:"#F44336",text:"#2196F3",voice:"#9C27B0"},f=e=>{var t;let{data:s}=e,n=Object.entries(s.sentimentDistribution).map(e=>{let[t,s]=e;return{name:t.charAt(0).toUpperCase()+t.slice(1),value:s}}),i=Object.entries(s.responsesByType).map(e=>{let[t,s]=e;return{name:t.charAt(0).toUpperCase()+t.slice(1),count:s}}),f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),N=s.topSections.map(e=>({name:e.sectionId.replace(/([A-Z])/g," $1").trim(),responses:e.responseCount,sentiment:Number((100*e.averageSentiment).toFixed(1))}));return(0,a.jsxs)("div",{className:"space-y-8 p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total Responses"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:s.totalResponses})]}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Average Sentiment"}),(0,a.jsxs)("p",{className:"text-3xl font-bold",children:[(100*s.averageSentiment).toFixed(1),"%"]})]}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Most Active Section"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:(null===(t=s.topSections[0])||void 0===t?void 0:t.sectionId)||"N/A"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)(r.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Sentiment Distribution"}),(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(o.u,{children:[(0,a.jsx)(d.b,{data:n,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:!0,children:n.map((e,t)=>(0,a.jsx)(c.b,{fill:j[e.name.toLowerCase()]},"cell-".concat(t)))}),(0,a.jsx)(m.u,{})]})})})]}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Response Types"}),(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(x.v,{data:i,children:[(0,a.jsx)(h.q,{strokeDasharray:"3 3"}),(0,a.jsx)(u.K,{dataKey:"name"}),(0,a.jsx)(p.B,{}),(0,a.jsx)(m.u,{}),(0,a.jsx)(v.$,{dataKey:"count",fill:"#2196F3"})]})})})]}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"bg-white rounded-lg shadow p-6 col-span-1 md:col-span-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Recent Trends"}),(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(g.w,{data:s.recentTrends,children:[(0,a.jsx)(h.q,{strokeDasharray:"3 3"}),(0,a.jsx)(u.K,{dataKey:"date",tickFormatter:f}),(0,a.jsx)(p.B,{yAxisId:"left"}),(0,a.jsx)(p.B,{yAxisId:"right",orientation:"right"}),(0,a.jsx)(m.u,{labelFormatter:f,formatter:(e,t)=>"averageSentiment"===t?["".concat((100*e).toFixed(1),"%"),"Average Sentiment"]:[e,"count"===t?"Response Count":t]}),(0,a.jsx)(y.x,{yAxisId:"left",type:"monotone",dataKey:"count",stroke:"#2196F3",name:"Response Count"}),(0,a.jsx)(y.x,{yAxisId:"right",type:"monotone",dataKey:"averageSentiment",stroke:"#4CAF50",name:"Average Sentiment"})]})})})]})]}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Section Performance"}),(0,a.jsx)("div",{className:"h-96",children:(0,a.jsx)(l.h,{width:"100%",height:"100%",children:(0,a.jsxs)(x.v,{data:N,layout:"vertical",children:[(0,a.jsx)(h.q,{strokeDasharray:"3 3",stroke:"#374151"}),(0,a.jsx)(u.K,{type:"number",stroke:"#9CA3AF"}),(0,a.jsx)(p.B,{dataKey:"name",type:"category",stroke:"#9CA3AF",width:150}),(0,a.jsx)(m.u,{contentStyle:{backgroundColor:"#1F2937",border:"none",borderRadius:"0.5rem"}}),(0,a.jsx)(b.D,{}),(0,a.jsx)(v.$,{dataKey:"responses",fill:"#3B82F6",name:"Response Count"}),(0,a.jsx)(v.$,{dataKey:"sentiment",fill:"#10B981",name:"Sentiment Score"})]})})})]})]})};var N=s(96692);function w(){let[e,t]=(0,n.useState)("responses"),[s,l]=(0,n.useState)([]),[o,d]=(0,n.useState)(null),[c,m]=(0,n.useState)(!0),[x,h]=(0,n.useState)(null),[u,p]=(0,n.useState)(null),v=n.useCallback(async()=>{m(!0),h(null);try{let e=await fetch("/api/feedback/index.php");if(!e.ok)throw Error("Failed to fetch feedback data");let t=await e.json();l(t.data||[]);let s=await fetch("/api/analytics/index.php");if(!s.ok)throw Error("Failed to fetch analytics data");let a=await s.json();d(a.data)}catch(e){h(e instanceof Error?e.message:"An error occurred")}finally{m(!1)}},[]);return((0,n.useEffect)(()=>{v()},[v]),c)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):x?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[(0,a.jsxs)("div",{className:"text-red-500 text-xl mb-4",children:["Error: ",x]}),(0,a.jsx)("button",{onClick:v,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Retry"})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Feedback Dashboard"}),(0,a.jsx)(i.default,{href:"/",className:"text-blue-500 hover:text-blue-600 transition-colors",children:"← Back to Form"})]}),(0,a.jsx)("button",{onClick:()=>{let e=JSON.stringify(s,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="feedback-responses.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Download Responses"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>t("responses"),className:"".concat("responses"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"),children:"Responses"}),(0,a.jsx)("button",{onClick:()=>t("analytics"),className:"".concat("analytics"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"),children:"Analytics"})]})})}),"responses"===e?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Feedback Responses"}),(0,a.jsx)("div",{className:"space-y-4",children:s.map((e,t)=>{var s,n,i;return(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},onClick:()=>p(e),className:"p-4 rounded-lg cursor-pointer transition-colors ".concat(u===e?"bg-blue-50 border-blue-200":"bg-gray-50 hover:bg-gray-100 border-gray-200"," border"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)("div",{className:"px-2 py-1 rounded text-xs ".concat((null===(s=e.sentiment)||void 0===s?void 0:s.label)==="positive"?"bg-green-100 text-green-800":(null===(n=e.sentiment)||void 0===n?void 0:n.label)==="negative"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:(null===(i=e.sentiment)||void 0===i?void 0:i.label)||"neutral"})]}),(0,a.jsx)("div",{className:"mt-2",children:Object.entries(e.sections||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("div",{className:"font-medium text-gray-700",children:t}),s.response&&(0,a.jsx)("div",{className:"text-gray-600 text-sm mt-1",children:s.response}),s.text&&(0,a.jsx)("div",{className:"text-gray-600 text-sm mt-1",children:s.text}),s.voiceResponse&&(0,a.jsx)("div",{className:"text-blue-500 text-sm mt-1",children:"Has voice response"}),s.audio&&(0,a.jsx)("div",{className:"text-blue-500 text-sm mt-1",children:"Has voice recording"})]},t)})})]},t)})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Response Details"}),u?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Submitted on"," ",new Date(u.timestamp).toLocaleString()]}),u.sentiment&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Sentiment Score: "}),(0,a.jsxs)("span",{className:u.sentiment.score>.6?"text-green-600":u.sentiment.score<.4?"text-red-600":"text-yellow-600",children:[(100*u.sentiment.score).toFixed(1),"%"]})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(u.sections||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:t}),s.response&&(0,a.jsx)("div",{className:"mt-2 text-gray-700",children:s.response}),s.voiceResponse&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)(N.z,{src:"string"==typeof s.voiceResponse?s.voiceResponse:s.voiceResponse.audioUrl}),"string"!=typeof s.voiceResponse&&s.voiceResponse.transcription&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Transcription: ",s.voiceResponse.transcription]})]})]},t)})})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Select a response to view details"})]})})]}):o&&(0,a.jsx)(f,{data:o})]})})}},96692:function(e,t,s){"use strict";s.d(t,{z:function(){return i}});var a=s(3827),n=s(64090),r=s(38371);let i=e=>{let{src:t,onDelete:s,showDelete:i=!1}=e,[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(0),[m,x]=(0,n.useState)(0),[h,u]=(0,n.useState)(null),p=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=p.current;if(!e)return;u(null),console.log("AudioPlayer: Loading audio from ".concat(t));let s=()=>c(e.currentTime),a=()=>{e.duration&&!isNaN(e.duration)&&(console.log("AudioPlayer: Duration loaded: ".concat(e.duration,"s")),x(e.duration))},n=()=>{console.log("AudioPlayer: Playback ended"),o(!1)},r=()=>{console.log("AudioPlayer: Audio can play now"),a()},i=t=>{var s;console.error("AudioPlayer: Error loading audio",t),u("Failed to load audio: ".concat((null===(s=e.error)||void 0===s?void 0:s.message)||"Unknown error"))},l=()=>{console.log("AudioPlayer: Waiting for data...")},d=()=>{console.log("AudioPlayer: Started playing"),o(!0)};e.addEventListener("timeupdate",s),e.addEventListener("loadedmetadata",a),e.addEventListener("canplay",r),e.addEventListener("ended",n),e.addEventListener("error",i),e.addEventListener("waiting",l),e.addEventListener("playing",d);try{e.load(),console.log("AudioPlayer: Audio load initiated")}catch(e){console.error("AudioPlayer: Failed to load audio",e),u("Error loading audio: ".concat(e))}return()=>{if(e.removeEventListener("timeupdate",s),e.removeEventListener("loadedmetadata",a),e.removeEventListener("canplay",r),e.removeEventListener("ended",n),e.removeEventListener("error",i),e.removeEventListener("waiting",l),e.removeEventListener("playing",d),t&&t.startsWith("blob:"))try{URL.revokeObjectURL(t),console.log("AudioPlayer: Revoked URL ".concat(t))}catch(e){console.error("AudioPlayer: Failed to revoke URL",e)}}},[t]);let v=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 shadow-sm",children:[(0,a.jsx)("audio",{ref:p,src:t,preload:"auto",onError:e=>console.error("AudioPlayer: Error event triggered",e)}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm mb-2",children:h}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(r.E.button,{whileTap:{scale:.95},onClick:()=>{if(p.current){if(l)p.current.pause(),o(!1),console.log("AudioPlayer: Paused");else{let e=p.current.play();void 0!==e&&e.then(()=>{o(!0),console.log("AudioPlayer: Playing started successfully")}).catch(e=>{console.error("AudioPlayer: Error playing audio:",e),u("Failed to play: ".concat(e.message||"Unknown error"))})}}},className:"w-10 h-10 flex items-center justify-center ".concat(h?"bg-gray-400":"bg-blue-500"," text-white rounded-full hover:").concat(h?"bg-gray-500":"bg-blue-600"," transition-colors"),disabled:!!h,children:l?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"relative w-full h-8 bg-gray-200 rounded-lg overflow-hidden cursor-pointer",onClick:e=>{if(!p.current||!m)return;let t=e.currentTarget.getBoundingClientRect(),s=(e.clientX-t.left)/t.width*m;p.current.currentTime=s,c(s)},children:(0,a.jsx)("div",{className:"absolute top-0 left-0 h-full bg-blue-500 transition-all duration-100",style:{width:"".concat(d/(m||1)*100,"%")}})}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 mt-1",children:[(0,a.jsx)("span",{children:v(d)}),(0,a.jsx)("span",{children:v(m)})]})]}),i&&s&&(0,a.jsx)(r.E.button,{whileTap:{scale:.95},onClick:s,className:"w-8 h-8 flex items-center justify-center text-red-500 hover:text-red-600 transition-colors",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]})]})}}},function(e){e.O(0,[266,705,971,69,744],function(){return e(e.s=62665)}),_N_E=e.O()}]);